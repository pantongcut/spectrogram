<!DOCTYPE html>
<html lang="zh-HK">

<head>
    <meta charset="UTF-8">
    <title>Bat AI Test</title>
    <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/ort.min.js"></script>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
        }

        .box {
            border: 1px solid #ccc;
            padding: 15px;
            margin-top: 10px;
            border-radius: 8px;
        }

        button {
            padding: 10px 20px;
            cursor: pointer;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
        }

        button:hover {
            background: #0056b3;
        }

        #result {
            font-weight: bold;
            color: green;
        }
    </style>
</head>

<body>

    <h1>ğŸ¦‡ è™è å«è² AI è¾¨è­˜å™¨ (ç¶²é ç‰ˆ)</h1>
    <p>é€™æ˜¯ä¸€å€‹æ¸¬è©¦é é¢ï¼Œç”¨ä¾†é©—è­‰ bat_model.onnx æ˜¯å¦èƒ½åœ¨ç€è¦½å™¨é‹è¡Œã€‚</p>

    <div class="box">
        <h3>æ¨¡æ“¬è¼¸å…¥æ•¸æ“š (10 å€‹åƒæ•¸)</h3>
        <p>å‡è¨­æˆ‘å€‘å¾éŒ„éŸ³ä¸­æå–äº†ä»¥ä¸‹ç‰¹å¾µï¼š</p>
        <code id="inputData">[0.5, 0.2, 0.8, 0.1, 0.5, 0.5, 0.2, 0.8, 0.1, 0.5]</code>
        <br><br>
        <button onclick="runAI()">ç«‹å³è¾¨è­˜</button>
    </div>

    <div class="box">
        <h3>è¾¨è­˜çµæœï¼š</h3>
        <p id="output">ç­‰å¾…åˆ†æ...</p>
    </div>

    <script>
        // æ¨¡æ“¬æ•¸æ“š
        const inputData = [
            4.5,   // Duration
            46.9,  // Low Freq
            4.5,   // Low Freq Time
            61.06, // High Freq
            0,     // High Freq Time
            48.38, // Peak Freq
            3.0,   // Peak Freq Time
            53.63, // Knee Freq
            0.25,  // Knee Freq Time
            49.13, // Heel Freq (å¦‚æœæ²’æœ‰å°±å¡« -1)
            2.08,  // Heel Freq Time
            48.38, // Char Freq
            6.0,   // Char Freq Time
            61.06, // Start Freq
            46.9,  // End Freq
            14.16  // Bandwidth
        ];

        async function runAI() {
            const outputDiv = document.getElementById('output');
            outputDiv.innerText = "æ­£åœ¨è¼‰å…¥æ¨¡å‹ä¸¦é‹ç®—...";

            try {
                // 1. å»ºç«‹ Session
                const session = await ort.InferenceSession.create('./bat_model.onnx');

                // 2. æº–å‚™è¼¸å…¥
                // æ³¨æ„ï¼šå¦‚æœå°‡ä¾†è¼¸å…¥åå­—è®Šäº†ï¼Œä¹Ÿå¯ä»¥ç”¨ session.inputNames[0] ä¾†æŸ¥
                const tensor = new ort.Tensor('float32', inputData, [1, 16]);
                const inputName = session.inputNames[0]; // è‡ªå‹•å–å¾—è¼¸å…¥åç¨± (é€šå¸¸æ˜¯ float_input)
                const feeds = {};
                feeds[inputName] = tensor;

                // 3. åŸ·è¡Œé æ¸¬
                const results = await session.run(feeds);

                // ============================================
                // ğŸŒŸ è‡ªå‹•åµæ¸¬è¼¸å‡ºåç¨± (ä¿®å¾©éŒ¯èª¤çš„é—œéµ)
                // ============================================
                console.log("æ¨¡å‹çš„æ‰€æœ‰è¼¸å‡º:", results); // åœ¨ Console é¡¯ç¤ºæ‰€æœ‰è³‡è¨Š

                // å–å¾—æ‰€æœ‰è¼¸å‡ºçš„åå­— (ä¾‹å¦‚ ['label', 'probabilities'])
                const outputKeys = Object.keys(results);

                // å‡è¨­ç¬¬ä¸€å€‹è¼¸å‡ºæ˜¯ã€Œåˆ†é¡æ¨™ç±¤ã€ï¼Œç¬¬äºŒå€‹æ˜¯ã€Œæ©Ÿç‡ã€
                // (é€šå¸¸ onnx æ¨¡å‹éƒ½æœƒæŠŠ label æ”¾åœ¨ç¬¬ä¸€å€‹)
                const labelKey = outputKeys[0];
                const probKey = outputKeys[1];

                console.log(`åµæ¸¬åˆ°è¼¸å‡ºåç¨± -> æ¨™ç±¤: ${labelKey}, æ©Ÿç‡: ${probKey}`);

                // 4. è®€å–æ•¸æ“š
                const prediction = results[labelKey].data[0];
                const rawProbabilities = results[probKey].data;
                const formattedProbs = Array.from(rawProbabilities).map(num =>
                    (num * 100).toFixed(2) + "%"
                );

                // é¡¯ç¤ºçµæœ
                outputDiv.innerHTML = `
                    é æ¸¬ç‰©ç¨®: <span id="result" style="font-size: 1.5em; color: blue;">${prediction}</span>
                    <br><br>
                    <small>è¼¸å‡ºåç¨±: ${labelKey}</small><br>
                    <small>å„é¡åˆ¥æ©Ÿç‡: <b>[ ${formattedProbs.join(', ')} ]</b></small>
                `;

            } catch (e) {
                console.error("ç™¼ç”ŸéŒ¯èª¤:", e);
                outputDiv.innerText = "ç™¼ç”ŸéŒ¯èª¤: " + e.message + " (è«‹æŒ‰ F12 çœ‹ Console)";
            }
        }
    </script>
</body>

</html>